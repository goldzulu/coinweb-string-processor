# Registring a Coinweb Smart Contract

The _deploy_ step involves publishing the smart contract to the Coinweb network.
This step requires a connection to a wallet GraphQL endpoint and the
`@coinweb/cweb-tool` package. The SDK registers the onchain code with the
provided method handlers, which will be used and explained in the upcoming
sections. The Coinweb SDK provides a simple way to register a smart contract to
the network.

## Setup the API Endpoint

If you work with the default DEVNET (not a local devcontainer) you can use the
public API endpoint by creating a `.env.yarn.devnet` file in the root directory
of your project.

```yaml
#API_ENDPOINT_DEVNET=http://localhost:5555/wallet <- local devcontainer example
API_ENDPOINT_DEVNET=https://api-devnet.coinweb.io/wallet
```

## Register a Smart Contract

The contract modules are preconfigured in such way that they can be registered
with the following command:

```bash
yarn deploy-contracts

# with the scripts looking like this:
# ..."deploy-contracts": "yarn publish-actions",
# ..."publish-actions": "cweb-tool publish .cweb-config/dapp-ecosystem.yaml .cweb-config/mnemonic.txt DEVNET_L1A $API_ENDPOINT_DEVNET",
```

The cweb-tool's `publish-actions` command is a composition of `gather`, `filter`
and `execute` actions:

```bash
...
"gather-actions": "cweb-tool gather-actions .dapp-ecosystem-lock.yaml .unfiltered-actions.yaml",
"filter-actions": "cweb-tool filter-actions --api-endpoint $API_ENDPOINT_DEVNET -n DEVNET_L1A ./.unfiltered-actions.yaml .actions.yaml",
"execute-actions": "cweb-tool execute-actions ./.actions.yaml ./cweb-config/mnemonic.txt DEVNET_L1A $API_ENDPOINT_DEVNET",
...
```

## Configuration Files

The most important configuration files are the `mnemonic.txt` and
`dapp-ecosystem.yaml` files. They are generally preconfigured and contain
default values for the DEVNET environment.

### Mnemonic.txt

The mnemonic is a seed phrase to your wallet, in this case a dev wallet, which
will be used to fund all the necessary transactions, such as publishing and
invoking the smart contracts.

```shell
priority supply couple broccoli balcony sort flag keep original wrong pottery version
```

### Dapp-ecosystem.yaml

This is a configuration file that describes the environment or eco-system in
which the Javascript contracts will be executed. As an example the default
dapp-ecosystem.yaml file for Javascript contracts looks like this:

```yaml
# This is a "index source" that specifies the dApp world as you see it.
#
# This index defines what interpreters, contract templates etc you want
# to use, and what they should be called.
#
# You can include external sources for this information in the `includes`
# section, and you include your own smart contract in the `contract_templates`
# section.
#

# We currently use a reference to the Coinweb in-house ecosystem definition file for devnet.
includes:
  - url: >-
      https://gitlab.com/api/v4/projects/47807501/packages/generic/contract_indexes/0.0.7/in_house_ecosystem_index.yaml
    blake3: 0d365f5bd4f20d6ba4c36b6f124bcb9f4c39ddcc035dd8dd49a7abe82e3cf6e3

interpreters: {}

contract_templates:
  # Our contract module.  The contract module is an npm package created in the `dist/out`
  # directory using the `yarn build` and `yarn pack` commands.
  - file:///./packages/string-processor.cm/dist/out/my-contract-module.tgz
```

The included url on the other hand points to the composition of the interpreters
and entry_points that are needed to create the VFS (Virtual File System) for the
contract execution, like the WASM js-interpreter and the auto-registry code.

```yaml
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.

interpreters:
  08d22589d92093f8cc56922a7d00d8227d4c9247e4f55672d2dca613a66b52c9:
    alias: std_js_contract_v0
    entry_point:
      url: >-
        https://gitlab.com/api/v4/projects/47807501/packages/generic/js_interpreters/0.0.1/cweb_quickcheck.wasm
      blake3: d54d4ab9cc80d4cf1c1e5ee19c0252afe9001d210d52f18bc118974e0372d537
    cli_args:
      - '--std'
      - contract/onchain.js
      - contract/parameters.json
    auto_registry_code:
      url: >-
        https://gitlab.com/api/v4/projects/47807501/packages/generic/js_interpreters/0.0.6/auto_register.js
      blake3: 9d5404c134260380eb465bdc5a44ab05391762cd504557cd0c6cb5911ccc5f9d
contract_templates: {}
```

### Contract Issuer

In coinweb, the contract-id is defined as the hash of the files that are loaded
to the Wasm Vm when a call to contract is invoked. This contract-id is computed 
independent of how those files are loaded.

This means any changes to your onchain code, or offchain code therefore, will 
result in a new hash, `id`, for the contract.

When we register an smartcontract, under the hood, what we do is:

- Store onchain the files that will define the smartcontract, such the wasm-bytecode 
  plus any embedded file to be used as configuration or interpreted code.

- Create an index so given a hash (the contract-id), we can find out which 
  files needs to be loaded to produce it.



### Claim Issuer:

The creator of the claim, typically a smart contract (id).



You can find the current contract's id in the footer of this tutorial. It is
created during the build phase, and after registration it must be referenced in
any related call operations.
